<!doctype html>
<html>

<head>
  <title>Whack-a-mole</title>
  <style>
    * {
      margin: 0;
      overflow: hidden;
    }
  </style>

</head>

<body>
  <canvas id="canv"></canvas>
  <!-- Engine-specific Code -->
  <script src="./engine/Vector2.js"></script>
  <script src="./engine/Scene.js"></script>
  <script src="./engine/GameObject.js"></script>
  <script src="./engine/Component.js"></script>
  <script src="./engine/Input.js"></script>
  <script src="./engine/Engine.js"></script>
  <script src="./engine/Time.js"></script>
  <script src="./engine/Collisions.js"></script>
  <script src="./engine/CameraGameObject.js"></script>
  <script src="./engine/SceneManager.js"></script>

  <script src="./engine/components/Transform.js"></script>
  <script src="./engine/components/Polygon.js"></script>
  <script src="./engine/components/Collider.js"></script>
  <script src="./engine/components/RigidBody.js"></script>
  <script src="./engine/components/Text.js"></script>
  <script src="./engine/components/Camera.js"></script>

  <script>

    class MainScene extends Scene {
      constructor() {
        super()

        const cameraGameObject = new CameraGameObject()
        cameraGameObject.getComponent(Camera).backgroundColor = "white"
        this.instantiate(cameraGameObject)

        const parent = this.instantiate(new MoleGameObject(), new Vector2(100, 100))
        const child = this.instantiate(new MoleChildGameObject(), new Vector2(100/25, 100/25))
        child.transform.setParent(parent.transform)
        const grandchild = this.instantiate(new MoleChildGameObject(), new Vector2(100/25, 100/25))
        grandchild.transform.setParent(child.transform)



        const points = this.instantiate(new PointsGameObject(), new Vector2(20, 0))

        const uiContainer = this.instantiate(new GameObject("UI Container Game Object"), new Vector2(0, 100))

        const title = this.instantiate(new GameObject("Title Game Object", {layer: "UI"}), new Vector2(300, 0))
        title.addComponent(new Text(), {text: "Celestial Whacker", fillStyle: "black"})
        title.transform.setParent(uiContainer.transform)
        points.transform.setParent(uiContainer.transform)
        
        
        
        this.instantiate(new ClickGameObject())
        
      }
    }

    class MoleGameObject extends GameObject {
      constructor() {
        super("Mole Game Object")
        this.addComponent(new Polygon(), { fillStyle: "blue", points: [new Vector2(-1, -1), new Vector2(-1, 1), new Vector2(1, 1), new Vector2(1, -1)] })
        this.transform.scale = new Vector2(25, 25)
        this.addComponent(new Collider())
        this.addComponent(new MoleController())
      }
    }

    class MoleController extends Component {
      update() {
        this.transform.rotation += -Time.deltaTime
      }
    }

    class MoleChildGameObject extends GameObject {
      constructor() {
        super("Mole Child Game Object")
        this.addComponent(new Polygon(), { fillStyle: "cyan", points: [new Vector2(-1, -1), new Vector2(-1, 1), new Vector2(1, 1), new Vector2(1, -1)] })
        this.transform.scale = new Vector2(1, 1)
        this.addComponent(new Collider())
        this.addComponent(new MoleChildController())
      }
    }

    class MoleChildController extends Component {
      update() {
        this.transform.rotation += -Time.deltaTime
      }
    }

    class PointsGameObject extends GameObject {
      constructor() {
        super("Points Game Object", {layer: "UI"})
        this.addComponent(new Text(), { fillStyle: "gray", text: "Points: ", font: "10px Arial" })
        this.addComponent(new PointsController())
        this.transform.scale = new Vector2(2, 2)
      }
    }

    class PointsController extends Component {
      points = 0
      update() {
        this.gameObject.getComponent(Text).text = "Points: " + this.points
        // this.transform.rotation += Time.deltaTime
      }
    }

    class ClickGameObject extends GameObject {
      constructor() {
        super("Click Game Object")
        this.addComponent(new Polygon(), { fillStyle: "black", points: [new Vector2(-1, -1), new Vector2(0, 1), new Vector2(1, -1)] })
        this.addComponent(new ClickController())
        this.addComponent(new Collider())
      }
    }

    class ClickController extends Component {
      update() {
        console.log(Input.buttonsDown, Input.mousePosition)
        if (Input.mousePosition) {

          this.transform.position = Camera.screenToWorldSpace(Input.mousePosition.clone())

        }
      }
      onCollisionEnter(other) {
        if (Input.buttonsUpThisFrame.includes(0))
          GameObject.find("Points Game Object").getComponent(PointsController).points++
      }
    }




    SceneManager.loadScene(new MainScene())
    Engine.start({ layers: [] })
  </script>
</body>

</html>